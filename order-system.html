<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ã‚ªãƒ¼ãƒ€ãƒ¼ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #f5f0e8 0%, #ebe4d8 100%);
            color: #333;
            overflow-x: hidden;
            padding: 0;
            margin: 0;
        }

        .container {
            max-width: 100vw;
            padding: 5px;
            min-height: 100vh;
        }

        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */
        .tab-buttons {
            display: flex;
            gap: 5px;
            margin-bottom: 8px;
            position: sticky;
            top: 0;
            background: #f5f0e8;
            padding: 5px 0;
            z-index: 100;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            background: #e0d8cc;
            color: #666;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #8b7355 0%, #a08968 100%);
            color: white;
            box-shadow: 0 2px 6px rgba(139, 115, 85, 0.3);
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* è¨­å®šãƒšãƒ¼ã‚¸ */
        .section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #8b7355;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e0d8cc;
        }

        /* è¡¨å½¢å¼ã®è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ« */
        .settings-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .settings-table th {
            background: #f5f0e8;
            padding: 10px 5px;
            text-align: center;
            font-weight: bold;
            color: #666;
            border: 1px solid #e0d8cc;
        }

        .settings-table td {
            padding: 8px 5px;
            text-align: center;
            border: 1px solid #e0d8cc;
        }

        .settings-table input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .settings-table input[type="text"],
        .settings-table input[type="number"] {
            width: 100%;
            padding: 6px;
            border: 1px solid #e0d8cc;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }

        .settings-table select {
            width: 100%;
            padding: 6px;
            border: 1px solid #e0d8cc;
            border-radius: 4px;
            font-size: 14px;
        }

        .allergy-btn {
            background: #e0d8cc;
            color: #666;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
        }

        .allergy-btn:active {
            background: #d0c8bc;
        }

        .checkbox-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
            white-space: nowrap;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .custom-input-row {
            background: #faf8f5;
        }

        .room-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #faf8f5;
            border-radius: 8px;
            cursor: pointer;
        }

        .checkbox-item input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-item label {
            font-size: 16px;
            cursor: pointer;
            flex: 1;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #555;
        }

        .input-group input[type="text"],
        .input-group input[type="number"],
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0d8cc;
            border-radius: 8px;
            font-size: 16px;
        }

        .room-config {
            border: 2px solid #e0d8cc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            background: #fdfcfa;
        }

        .room-config-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .room-config-header h4 {
            color: #8b7355;
            font-size: 18px;
        }

        .delete-room-btn {
            background: #d88a8a;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .allergy-modal-content {
            max-height: 70vh;
            overflow-y: auto;
        }

        .allergy-input-group {
            margin-bottom: 15px;
        }

        .allergy-input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
        }

        .allergy-input-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0d8cc;
            border-radius: 8px;
            font-size: 14px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8b7355 0%, #a08968 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(139, 115, 85, 0.3);
        }

        .btn-primary:active {
            transform: translateY(2px);
            box-shadow: 0 1px 4px rgba(139, 115, 85, 0.3);
        }

        .btn-secondary {
            background: #e0d8cc;
            color: #666;
        }

        /* å–¶æ¥­ãƒšãƒ¼ã‚¸ */
        .time-group {
            margin-bottom: 10px;
        }

        .time-header {
            background: linear-gradient(135deg, #8b7355 0%, #a08968 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            text-align: center;
            box-shadow: 0 1px 4px rgba(139, 115, 85, 0.3);
        }

        .room-card {
            background: white;
            border-radius: 10px;
            padding: 8px;
            margin-bottom: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .room-info {
            min-width: 120px;
            max-width: 120px;
            padding-right: 10px;
            border-right: 2px solid #f0ebe3;
        }

        .room-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2px;
        }

        .room-name {
            font-size: 16px;
            font-weight: bold;
            color: #8b7355;
        }

        .room-plan {
            font-size: 10px;
            color: #999;
            margin-top: 2px;
        }

        .room-people {
            font-size: 24px;
            font-weight: bold;
            color: #8b7355;
        }

        .room-memo {
            font-size: 10px;
            color: #666;
            margin-top: 3px;
            font-style: italic;
        }

        .eating-speed {
            display: inline-block;
            padding: 3px 8px;
            background: #e8e8e8;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 4px;
            transition: all 0.3s;
        }

        .eating-speed:active {
            background: #d8d8d8;
        }

        .course-grid {
            display: flex;
            gap: 8px;
            flex: 1;
            flex-wrap: wrap;
            align-items: center;
        }

        .course-item {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .course-name {
            font-size: 10px;
            color: #666;
            margin-bottom: 3px;
            font-weight: bold;
        }

        .course-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #ddd;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 3px;
            position: relative;
        }

        .course-button.status-wait {
            background: #fff9e6;
            border-color: #f5d742;
            color: #333;
        }

        .course-button.status-order {
            background: #ffe8d6;
            border-color: #ff9f5a;
            color: #333;
        }

        .course-button.status-meat {
            background: #ffe0e6;
            border-color: #ff6b9d;
            color: #333;
        }

        .course-button.status-serve {
            background: #d4f4dd;
            border-color: #52c97a;
            color: #333;
        }

        .course-info {
            font-size: 9px;
            color: #666;
            min-height: 20px;
        }

        .time-display {
            font-weight: bold;
            color: #8b7355;
            font-size: 10px;
        }

        .staff-display {
            color: #666;
            font-size: 9px;
            margin-top: 1px;
        }

        .allergy-badge {
            font-size: 8px;
            color: #d88a8a;
            font-weight: bold;
            position: absolute;
            top: -6px;
            right: -6px;
            background: white;
            padding: 1px 4px;
            border-radius: 8px;
            border: 1px solid #d88a8a;
            white-space: nowrap;
        }

        .cake-badge {
            display: inline-block;
            background: #ffd6e0;
            color: #d5006d;
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: bold;
            margin-left: 3px;
        }

        .pressed-time {
            font-size: 8px;
            color: #999;
            margin-top: 2px;
        }

        .w-count-display {
            font-size: 9px;
            font-weight: bold;
            color: #ff1744;
            margin-top: 2px;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-title {
            font-size: 20px;
            font-weight: bold;
            color: #8b7355;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .modal-btn {
            padding: 18px;
            border: 2px solid #e0d8cc;
            border-radius: 12px;
            background: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn:active {
            background: #f0ebe3;
        }

        .modal-close {
            width: 100%;
            padding: 15px;
            background: #e0d8cc;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
        }

        .w-count-display {
            font-size: 11px;
            font-weight: bold;
            color: #ff1744;
            margin-top: 3px;
        }

        .staff-select-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .undo-btn {
            position: fixed;
            bottom: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b7355 0%, #a08968 100%);
            color: white;
            border: none;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            z-index: 50;
        }

        .undo-btn:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .course-button {
                width: 45px;
                height: 45px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ã‚¿ãƒ–ãƒœã‚¿ãƒ³ -->
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="switchTab('index')">è¨­å®š (Index)</button>
            <button class="tab-btn" onclick="switchTab('order')">å–¶æ¥­ (Order)</button>
        </div>

        <!-- è¨­å®šãƒšãƒ¼ã‚¸ -->
        <div id="index-page" class="page active">
            <div class="section">
                <div class="section-title">1. æœ¬æ—¥ã®è¨­å®š</div>
                <p style="font-size: 13px; color: #666; margin-bottom: 15px;">
                    ãƒã‚§ãƒƒã‚¯ã—ãŸéƒ¨å±‹ã ã‘ãŒå–¶æ¥­ãƒšãƒ¼ã‚¸ã«åæ˜ ã•ã‚Œã‚‹è¨­å®šã§ã™ã€‚
                </p>
                <table class="settings-table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">é¸</th>
                            <th style="width: 100px;">éƒ¨å±‹å</th>
                            <th style="width: 80px;">äººæ•°</th>
                            <th style="width: 120px;">ãƒ—ãƒ©ãƒ³</th>
                            <th style="width: 100px;">å¤•é£Ÿé–‹å§‹</th>
                            <th style="width: 180px;">ãŠç¥ã„ãƒ»ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼</th>
                            <th style="width: 100px;">éƒ¨å±‹ãƒ¡ãƒ¢</th>
                        </tr>
                    </thead>
                    <tbody id="room-settings-table">
                        <!-- å‹•çš„ã«ç”Ÿæˆ -->
                    </tbody>
                </table>
            </div>

            <div class="section">
                <div class="section-title">7. è¿½åŠ æ–™ç†</div>
                <div id="additional-dishes">
                    <!-- è¿½åŠ æ–™ç†ãŒå‹•çš„ã«è¿½åŠ ã•ã‚Œã‚‹ -->
                </div>
                <button class="btn btn-secondary" onclick="addAdditionalDish()">è¿½åŠ æ–™ç†ã‚’è¿½åŠ </button>
            </div>

            <div class="section">
                <div class="section-title">9. ã‚¹ã‚¿ãƒƒãƒ•ï¼ˆå‡ºå‹¤è€…ï¼‰é¸æŠ</div>
                <div class="room-grid" id="staff-checkboxes">
                    <!-- ã‚¹ã‚¿ãƒƒãƒ•ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ -->
                </div>
                <div style="margin-top: 15px;">
                    <label style="font-weight: bold; margin-bottom: 8px; display: block;">ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚¿ãƒƒãƒ•</label>
                    <input type="text" id="custom-staff-input" placeholder="ã‚¹ã‚¿ãƒƒãƒ•åã‚’å…¥åŠ›" 
                           style="width: 100%; padding: 12px; border: 2px solid #e0d8cc; border-radius: 8px; font-size: 16px;">
                    <button class="btn btn-secondary" onclick="addCustomStaff()" style="margin-top: 10px;">
                        ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚¿ãƒƒãƒ•ã‚’è¿½åŠ 
                    </button>
                </div>
            </div>

            <button class="btn btn-primary" onclick="saveSettings()">ä¿å­˜ã—ã¦å–¶æ¥­ãƒšãƒ¼ã‚¸ã¸</button>
            <button class="btn btn-secondary" onclick="resetSettings()">åˆæœŸåŒ–</button>
        </div>

        <!-- å–¶æ¥­ãƒšãƒ¼ã‚¸ -->
        <div id="order-page" class="page">
            <div id="order-content">
                <!-- å–¶æ¥­å†…å®¹ãŒå‹•çš„ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
            </div>
            <button class="undo-btn" onclick="undoLastAction()">â†¶</button>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modal-title"></div>
            <div id="modal-body"></div>
            <button class="modal-close" onclick="closeModal()">é–‰ã˜ã‚‹</button>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
        const FIXED_ROOMS = ['ã‚„ã¾ã¶ã', 'ãªã§ã—ã“', 'ã¤ã°ã', 'ã‚„ã—ãŠ', 'ã•ãã‚‰', 'ãµã˜', 'ã•ã¤ã', 'ãã™ã’', 'ã‚†ã‚Š', 'ã¯ã'];
        const FIXED_STAFF = ['çœŸå¼“', 'ãƒŸãƒ³ã‚°ãƒ', 'ãƒœãƒ“ãƒ¼', 'ã‚µãƒ©ãƒŸ', 'ãƒ‘ãƒ“', 'ç¿”å¹³'];
        
        const PLANS = {
            'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰': ['å¸ç‰©', 'æœèœç››ã‚Š', 'è’¸ç‰©', 'æšç‰©', 'ç…®ç‰©', 'ã”é£¯', 'ç”˜å‘³'],
            'å’Œç‰›æ‡çŸ³': ['å¸ç‰©', 'æœèœç››ã‚Š', 'ã™ãç„¼ã', 'ãƒ•ãƒ©ã‚¤', 'ã‚¹ãƒ†ãƒ¼ã‚­', 'ã”é£¯', 'ç”˜å‘³'],
            'ã‚¹ãƒ†ãƒ¼ã‚­': ['å¸ç‰©', 'æœèœç››ã‚Š', 'è’¸ç‰©', 'æšç‰©', 'ã‚¹ãƒ†ãƒ¼ã‚­', 'ã”é£¯', 'ç”˜å‘³'],
            'ã—ã‚ƒã¶ã—ã‚ƒã¶': ['å¸ç‰©', 'æœèœç››ã‚Š', 'ã—ã‚ƒã¶ã—ã‚ƒã¶', 'è’¸ç‰©', 'æšç‰©', 'ã”é£¯', 'ç”˜å‘³'],
            'é€£æ³Š': ['èŒ¶ç¢—è’¸ã—', 'ç‰›ãŸãŸã', 'ç„¼ç‰©', 'å°é‰¢', 'æšç‰©', 'ã”é£¯', 'ç”˜å‘³']
        };

        let settings = {
            rooms: [],
            staff: [],
            additionalDishes: [],
            customRooms: [],
            customStaff: []
        };

        let orderState = {};
        let lastAction = null;

        const EATING_SPEEDS = ['VF', 'F', 'LF', 'N', 'LS', 'S', 'VS'];

        // åˆæœŸåŒ–
        function init() {
            loadSettings();
            renderIndexPage();
            renderOrderPage();
        }

        // è¨­å®šèª­ã¿è¾¼ã¿
        function loadSettings() {
            const saved = localStorage.getItem('orderSettings');
            if (saved) {
                settings = JSON.parse(saved);
                // å¤ã„ãƒ‡ãƒ¼ã‚¿ã®äº’æ›æ€§ã®ãŸã‚
                if (!settings.customRooms) settings.customRooms = [];
                if (!settings.customStaff) settings.customStaff = [];
            } else {
                // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
                settings = {
                    rooms: FIXED_ROOMS.map(name => ({
                        name: name,
                        enabled: true,
                        people: 2,
                        time: '18:00',
                        plan: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰',
                        memo: '',
                        allergies: {},
                        hasCake: false,
                        hasPlate: false,
                        isCustom: false
                    })),
                    staff: FIXED_STAFF.map(name => ({ name: name, enabled: true, isCustom: false })),
                    additionalDishes: [],
                    customRooms: [],
                    customStaff: []
                };
            }

            const savedOrder = localStorage.getItem('orderState');
            if (savedOrder) {
                orderState = JSON.parse(savedOrder);
            }
        }

        // è¨­å®šä¿å­˜
        function saveSettings() {
            localStorage.setItem('orderSettings', JSON.stringify(settings));
            initOrderState();
            saveOrderState();
            switchTab('order');
            alert('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
        }

        // è¨­å®šåˆæœŸåŒ–
        function resetSettings() {
            if (!confirm('åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆéƒ¨å±‹ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ã¯å…¨é¸æŠã€äººæ•°2åã€æ™‚é–“18:00ã€ãƒ—ãƒ©ãƒ³ã¯ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ï¼‰')) {
                return;
            }
            
            settings = {
                rooms: FIXED_ROOMS.map(name => ({
                    name: name,
                    enabled: true,
                    people: 2,
                    time: '18:00',
                    plan: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰',
                    memo: '',
                    allergies: {},
                    hasCake: false,
                    hasPlate: false,
                    isCustom: false
                })),
                staff: FIXED_STAFF.map(name => ({ name: name, enabled: true, isCustom: false })),
                additionalDishes: [],
                customRooms: [],
                customStaff: []
            };
            
            localStorage.setItem('orderSettings', JSON.stringify(settings));
            renderIndexPage();
            alert('åˆæœŸåŒ–ã—ã¾ã—ãŸï¼');
        }

        // OrderçŠ¶æ…‹åˆæœŸåŒ–
        function initOrderState() {
            orderState = {};
            const allRooms = [...settings.rooms.filter(r => r.enabled), ...settings.customRooms.filter(r => r.enabled)];
            
            allRooms.forEach(room => {
                const courses = PLANS[room.plan];
                orderState[room.name] = {
                    eatingSpeed: 'N',
                    courses: {}
                };
                courses.forEach(course => {
                    orderState[room.name].courses[course] = {
                        status: 'none',
                        time: null,
                        pressedTime: null,
                        staff: null,
                        wCount: 0
                    };
                });
            });
        }

        // OrderçŠ¶æ…‹ä¿å­˜
        function saveOrderState() {
            localStorage.setItem('orderState', JSON.stringify(orderState));
        }

        // è¨­å®šãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderIndexPage() {
            // éƒ¨å±‹è¨­å®šãƒ†ãƒ¼ãƒ–ãƒ«
            const tableBody = document.getElementById('room-settings-table');
            tableBody.innerHTML = '';
            
            // å…¨ã¦ã®éƒ¨å±‹ï¼ˆå›ºå®šï¼‹ã‚«ã‚¹ã‚¿ãƒ ï¼‰
            const allRooms = [...settings.rooms, ...settings.customRooms];
            
            allRooms.forEach((room, index) => {
                const tr = document.createElement('tr');
                if (room.isCustom) tr.className = 'custom-input-row';
                
                const isCustomRoom = room.isCustom;
                const actualIndex = isCustomRoom ? 
                    settings.rooms.length + settings.customRooms.indexOf(room) : 
                    settings.rooms.indexOf(room);
                
                tr.innerHTML = `
                    <td>
                        <input type="checkbox" ${room.enabled ? 'checked' : ''} 
                               onchange="${isCustomRoom ? `toggleCustomRoom(${settings.customRooms.indexOf(room)})` : `toggleRoom(${actualIndex})`}">
                    </td>
                    <td>
                        ${isCustomRoom ? 
                            `<input type="text" value="${room.name}" onchange="updateCustomRoomName(${settings.customRooms.indexOf(room)}, this.value)" placeholder="éƒ¨å±‹å">` : 
                            room.name
                        }
                        ${isCustomRoom ? 
                            `<br><button class="delete-room-btn" style="margin-top: 5px; padding: 4px 8px; font-size: 11px;" onclick="deleteCustomRoom(${settings.customRooms.indexOf(room)})">å‰Šé™¤</button>` : 
                            ''
                        }
                    </td>
                    <td>
                        <input type="number" min="1" max="10" value="${room.people}" 
                               onchange="${isCustomRoom ? `updateCustomRoomPeople(${settings.customRooms.indexOf(room)}, this.value)` : `updateRoomPeople(${actualIndex}, this.value)`}">
                    </td>
                    <td>
                        <select onchange="${isCustomRoom ? `updateCustomRoomPlan(${settings.customRooms.indexOf(room)}, this.value)` : `updateRoomPlan(${actualIndex}, this.value)`}">
                            ${Object.keys(PLANS).map(p => 
                                `<option value="${p}" ${room.plan === p ? 'selected' : ''}>${p}</option>`
                            ).join('')}
                        </select>
                    </td>
                    <td>
                        <select onchange="${isCustomRoom ? `updateCustomRoomTime(${settings.customRooms.indexOf(room)}, this.value)` : `updateRoomTime(${actualIndex}, this.value)`}">
                            <option value="18:00" ${room.time === '18:00' ? 'selected' : ''}>18:00</option>
                            <option value="18:30" ${room.time === '18:30' ? 'selected' : ''}>18:30</option>
                            <option value="19:00" ${room.time === '19:00' ? 'selected' : ''}>19:00</option>
                        </select>
                    </td>
                    <td>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" ${room.hasCake ? 'checked' : ''} 
                                       onchange="${isCustomRoom ? `updateCustomRoomCake(${settings.customRooms.indexOf(room)}, this.checked)` : `updateRoomCake(${actualIndex}, this.checked)`}">
                                ã‚±ãƒ¼ã‚­
                            </label>
                            <label>
                                <input type="checkbox" ${room.hasPlate ? 'checked' : ''} 
                                       onchange="${isCustomRoom ? `updateCustomRoomPlate(${settings.customRooms.indexOf(room)}, this.checked)` : `updateRoomPlate(${actualIndex}, this.checked)`}">
                                ãƒ—ãƒ¬ãƒ¼ãƒˆ
                            </label>
                        </div>
                        <button class="allergy-btn" style="margin-top: 5px;" 
                                onclick="${isCustomRoom ? `showAllergyModal(${settings.customRooms.indexOf(room)}, true)` : `showAllergyModal(${actualIndex}, false)`}">
                            ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è©³ç´°è¨­å®š
                        </button>
                    </td>
                    <td>
                        <input type="text" maxlength="10" value="${room.memo || ''}" placeholder="ãƒ¡ãƒ¢"
                               onchange="${isCustomRoom ? `updateCustomRoomMemo(${settings.customRooms.indexOf(room)}, this.value)` : `updateRoomMemo(${actualIndex}, this.value)`}">
                    </td>
                `;
                tableBody.appendChild(tr);
            });
            
            // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºéƒ¨å±‹è¿½åŠ è¡Œ
            const addRow = document.createElement('tr');
            addRow.className = 'custom-input-row';
            addRow.innerHTML = `
                <td colspan="7" style="text-align: center; padding: 15px;">
                    <button class="btn btn-secondary" onclick="addCustomRoom()" style="width: auto; padding: 10px 30px;">
                        ï¼‹ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºéƒ¨å±‹ã‚’è¿½åŠ 
                    </button>
                </td>
            `;
            tableBody.appendChild(addRow);

            // ã‚¹ã‚¿ãƒƒãƒ•ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹
            const staffCheckboxes = document.getElementById('staff-checkboxes');
            staffCheckboxes.innerHTML = '';
            
            // å›ºå®šã‚¹ã‚¿ãƒƒãƒ•
            settings.staff.forEach((staff, index) => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.innerHTML = `
                    <input type="checkbox" id="staff-${index}" ${staff.enabled ? 'checked' : ''} 
                           onchange="toggleStaff(${index})">
                    <label for="staff-${index}">${staff.name}</label>
                `;
                staffCheckboxes.appendChild(div);
            });
            
            // ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ãƒƒãƒ•
            settings.customStaff.forEach((staff, index) => {
                const div = document.createElement('div');
                div.className = 'checkbox-item';
                div.style.background = '#faf8f5';
                div.innerHTML = `
                    <input type="checkbox" id="custom-staff-${index}" ${staff.enabled ? 'checked' : ''} 
                           onchange="toggleCustomStaff(${index})">
                    <label for="custom-staff-${index}">${staff.name}</label>
                    <button class="delete-room-btn" style="margin-left: auto; padding: 6px 12px; font-size: 12px;" 
                            onclick="deleteCustomStaff(${index})">å‰Šé™¤</button>
                `;
                staffCheckboxes.appendChild(div);
            });

            // è¿½åŠ æ–™ç†
            renderAdditionalDishes();
        }

        // è¿½åŠ æ–™ç†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderAdditionalDishes() {
            const container = document.getElementById('additional-dishes');
            container.innerHTML = '';
            
            const allRooms = [
                ...settings.rooms.filter(r => r.enabled),
                ...settings.customRooms.filter(r => r.enabled)
            ];
            
            settings.additionalDishes.forEach((dish, index) => {
                const div = document.createElement('div');
                div.className = 'room-config';
                div.innerHTML = `
                    <div class="room-config-header">
                        <h4>è¿½åŠ æ–™ç† ${index + 1}</h4>
                        <button class="delete-room-btn" onclick="removeAdditionalDish(${index})">å‰Šé™¤</button>
                    </div>
                    <div class="input-group">
                        <label>å“å</label>
                        <input type="text" value="${dish.name}" 
                               onchange="updateDishName(${index}, this.value)">
                    </div>
                    <div class="input-group">
                        <label>æ•°é‡</label>
                        <input type="number" min="1" max="10" value="${dish.quantity}" 
                               onchange="updateDishQuantity(${index}, this.value)">
                    </div>
                    <div class="input-group">
                        <label>å¯¾è±¡éƒ¨å±‹</label>
                        ${allRooms.map((room, rIndex) => {
                            // å®Ÿéš›ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å–å¾—ï¼ˆå›ºå®šéƒ¨å±‹ã‹ã‚«ã‚¹ã‚¿ãƒ éƒ¨å±‹ã‹ï¼‰
                            const actualIndex = room.isCustom ? 
                                'custom-' + settings.customRooms.indexOf(room) : 
                                settings.rooms.indexOf(room);
                            const checked = dish.rooms.includes(actualIndex) ? 'checked' : '';
                            return `
                                <label style="display: inline-block; margin-right: 15px; font-weight: normal;">
                                    <input type="checkbox" ${checked} 
                                           onchange="toggleDishRoom(${index}, '${actualIndex}', this.checked)">
                                    ${room.name}
                                </label>
                            `;
                        }).join('')}
                    </div>
                    <div class="input-group">
                        <label>æŒ¿å…¥ä½ç½®</label>
                        ${dish.rooms.map(roomId => {
                            const room = roomId.toString().startsWith('custom-') ? 
                                settings.customRooms[parseInt(roomId.split('-')[1])] :
                                settings.rooms[roomId];
                            if (!room) return '';
                            const courses = PLANS[room.plan];
                            const currentPos = dish.positions[roomId] || courses[0];
                            return `
                                <div style="margin: 8px 0;">
                                    <label style="font-weight: normal; font-size: 14px;">${room.name}:</label>
                                    <select onchange="updateDishPosition(${index}, '${roomId}', this.value)" 
                                            style="margin-top: 5px;">
                                        ${courses.map(c => 
                                            `<option value="${c}" ${currentPos === c ? 'selected' : ''}>${c}ã®å‰</option>`
                                        ).join('')}
                                    </select>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function addAdditionalDish() {
            settings.additionalDishes.push({
                name: '',
                quantity: 1,
                rooms: [],
                positions: {}
            });
            renderAdditionalDishes();
        }

        function removeAdditionalDish(index) {
            settings.additionalDishes.splice(index, 1);
            renderAdditionalDishes();
        }

        function updateDishName(index, value) {
            settings.additionalDishes[index].name = value;
        }

        function updateDishQuantity(index, value) {
            settings.additionalDishes[index].quantity = parseInt(value);
        }

        function toggleDishRoom(dishIndex, roomId, checked) {
            const dish = settings.additionalDishes[dishIndex];
            if (checked) {
                if (!dish.rooms.includes(roomId)) {
                    dish.rooms.push(roomId);
                    const room = roomId.toString().startsWith('custom-') ? 
                        settings.customRooms[parseInt(roomId.split('-')[1])] :
                        settings.rooms[roomId];
                    const courses = PLANS[room.plan];
                    dish.positions[roomId] = courses[0];
                }
            } else {
                dish.rooms = dish.rooms.filter(r => r !== roomId);
                delete dish.positions[roomId];
            }
            renderAdditionalDishes();
        }

        function updateDishPosition(dishIndex, roomId, position) {
            settings.additionalDishes[dishIndex].positions[roomId] = position;
        }

        // å–¶æ¥­ãƒšãƒ¼ã‚¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
        function renderOrderPage() {
            const content = document.getElementById('order-content');
            content.innerHTML = '';

            // å…¨ã¦ã®æœ‰åŠ¹ãªéƒ¨å±‹ï¼ˆå›ºå®šï¼‹ã‚«ã‚¹ã‚¿ãƒ ï¼‰
            const allRooms = [
                ...settings.rooms.filter(r => r.enabled),
                ...settings.customRooms.filter(r => r.enabled)
            ];

            // æ™‚é–“å¸¯ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
            const timeGroups = {
                '18:00': [],
                '18:30': [],
                '19:00': []
            };

            allRooms.forEach(room => {
                if (timeGroups[room.time]) {
                    timeGroups[room.time].push(room);
                }
            });

            // å„æ™‚é–“å¸¯ã‚’è¡¨ç¤º
            Object.keys(timeGroups).forEach(time => {
                if (timeGroups[time].length === 0) return;

                const timeDiv = document.createElement('div');
                timeDiv.className = 'time-group';
                timeDiv.innerHTML = `<div class="time-header">${time} é–‹å§‹</div>`;

                timeGroups[time].forEach(room => {
                    const roomDiv = createRoomCard(room);
                    timeDiv.appendChild(roomDiv);
                });

                content.appendChild(timeDiv);
            });

            // åˆæœŸåŒ–ãƒœã‚¿ãƒ³
            const resetBtn = document.createElement('button');
            resetBtn.className = 'btn btn-secondary';
            resetBtn.textContent = 'OrderåˆæœŸåŒ–';
            resetBtn.onclick = resetOrderState;
            resetBtn.style.marginTop = '20px';
            content.appendChild(resetBtn);
        }

        function createRoomCard(room) {
            const div = document.createElement('div');
            div.className = 'room-card';

            const courses = PLANS[room.plan];
            const roomState = orderState[room.name] || { eatingSpeed: 'N', courses: {} };

            let cakeInfo = '';
            if (room.hasCake) cakeInfo += '<span class="cake-badge">ğŸ‚</span>';
            if (room.hasPlate) cakeInfo += '<span class="cake-badge">ğŸ½ï¸</span>';

            div.innerHTML = `
                <div class="room-info">
                    <div class="room-header">
                        <div class="room-name">${room.name}</div>
                        <div class="room-people">${room.people}å</div>
                    </div>
                    <div class="room-plan">${room.plan}${cakeInfo}</div>
                    ${room.memo ? `<div class="room-memo">${room.memo}</div>` : ''}
                    <div class="eating-speed" onclick="showEatingSpeedModal('${room.name}')">
                        ${roomState.eatingSpeed}
                    </div>
                </div>
                <div class="course-grid" id="courses-${room.name}">
                    ${courses.map(course => createCourseButton(room, course, roomState.courses[course])).join('')}
                </div>
            `;

            return div;
        }

        function createCourseButton(room, course, state) {
            if (!state) {
                state = { status: 'none', time: null, pressedTime: null, staff: null, wCount: 0 };
            }

            const allergy = room.allergies[course] || '';
            const allergyBadge = allergy ? `<div class="allergy-badge">${allergy}NG</div>` : '';
            
            let buttonText = 'æœª';
            let statusClass = '';
            
            if (state.status === 'wait') {
                buttonText = state.time ? state.time.split(':')[1] : 'å¾…';
                statusClass = 'status-wait';
            } else if (state.status === 'order') {
                buttonText = 'æ³¨';
                statusClass = 'status-order';
            } else if (state.status === 'meat') {
                buttonText = 'è‚‰';
                statusClass = 'status-meat';
            } else if (state.status === 'serve') {
                buttonText = 'æ';
                statusClass = 'status-serve';
            }

            const cakeBadge = (course === 'ç”˜å‘³' && (room.hasCake || room.hasPlate)) ? 
                `${room.hasCake ? '<span class="cake-badge">ğŸ‚</span>' : ''}${room.hasPlate ? '<span class="cake-badge">ğŸ½ï¸</span>' : ''}` : '';

            return `
                <div class="course-item">
                    <div class="course-name">${course}${cakeBadge}</div>
                    <div class="course-button ${statusClass}" onclick="clickCourse('${room.name}', '${course}')">
                        ${allergyBadge}
                        ${buttonText}
                    </div>
                    <div class="course-info">
                        ${state.time ? `<div class="time-display">${state.time}</div>` : ''}
                        ${state.pressedTime ? `<div class="pressed-time">${state.pressedTime}</div>` : ''}
                        ${state.staff ? `<div class="staff-display">${state.staff}</div>` : ''}
                        ${state.wCount > 0 ? `<div class="w-count-display">WÃ—${state.wCount}</div>` : ''}
                    </div>
                </div>
            `;
        }

        // ã‚³ãƒ¼ã‚¹ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
        function clickCourse(roomName, courseName) {
            let room = settings.rooms.find(r => r.name === roomName);
            if (!room) {
                room = settings.customRooms.find(r => r.name === roomName);
            }
            if (!room) return;

            const state = orderState[roomName].courses[courseName];
            
            // æœ€å¾Œã®æ“ä½œã‚’ä¿å­˜
            lastAction = {
                room: roomName,
                course: courseName,
                previousState: JSON.parse(JSON.stringify(state))
            };

            // çŠ¶æ…‹é·ç§»
            if (courseName === 'æœèœç››ã‚Š' || courseName === 'ã—ã‚ƒã¶ã—ã‚ƒã¶') {
                // æœèœç››ã‚Šã€ã—ã‚ƒã¶ã—ã‚ƒã¶: æœª â†’ å¾… â†’ æ â†’ æœª
                if (state.status === 'none') {
                    state.status = 'wait';
                    state.pressedTime = getCurrentTime();
                    showTimeModal(roomName, courseName);
                } else if (state.status === 'wait') {
                    state.status = 'serve';
                    showStaffModal(roomName, courseName);
                } else {
                    state.status = 'none';
                    state.time = null;
                    state.pressedTime = null;
                    state.staff = null;
                }
            } else if (courseName === 'ã‚¹ãƒ†ãƒ¼ã‚­' || courseName === 'ç…®ç‰©') {
                // ã‚¹ãƒ†ãƒ¼ã‚­ã€ç…®ç‰©: æœª â†’ å¾… â†’ è‚‰ â†’ æ³¨ â†’ æ â†’ æœª
                if (state.status === 'none') {
                    state.status = 'wait';
                    state.pressedTime = getCurrentTime();
                    showTimeModal(roomName, courseName);
                } else if (state.status === 'wait') {
                    state.status = 'meat';
                    showWCountModal(roomName, courseName);
                } else if (state.status === 'meat') {
                    state.status = 'order';
                } else if (state.status === 'order') {
                    state.status = 'serve';
                    showStaffModal(roomName, courseName);
                } else {
                    state.status = 'none';
                    state.time = null;
                    state.pressedTime = null;
                    state.staff = null;
                    state.wCount = 0;
                }
            } else {
                // é€šå¸¸: æœª â†’ å¾… â†’ æ³¨ â†’ æ â†’ æœª
                if (state.status === 'none') {
                    state.status = 'wait';
                    state.pressedTime = getCurrentTime();
                    showTimeModal(roomName, courseName);
                } else if (state.status === 'wait') {
                    state.status = 'order';
                } else if (state.status === 'order') {
                    state.status = 'serve';
                    showStaffModal(roomName, courseName);
                } else {
                    state.status = 'none';
                    state.time = null;
                    state.pressedTime = null;
                    state.staff = null;
                }
            }

            saveOrderState();
            renderOrderPage();
        }

        // ç¾åœ¨æ™‚åˆ»å–å¾—
        function getCurrentTime() {
            const now = new Date();
            const h = String(now.getHours()).padStart(2, '0');
            const m = String(now.getMinutes()).padStart(2, '0');
            return `${h}:${m}`;
        }

        // æ™‚é–“é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
        function showTimeModal(roomName, courseName) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = 'æä¾›äºˆå®šæ™‚åˆ»ã‚’é¸æŠ';
            
            const options = [3, 5, 10, 15, 20, 25];
            body.innerHTML = `
                <div class="modal-buttons">
                    ${options.map(min => `
                        <button class="modal-btn" onclick="setTime('${roomName}', '${courseName}', ${min})">
                            +${min}åˆ†
                        </button>
                    `).join('')}
                    <button class="modal-btn" onclick="setTime('${roomName}', '${courseName}', 0)">
                        å£°ãŒã‘
                    </button>
                </div>
            `;

            modal.classList.add('active');
        }

        function setTime(roomName, courseName, minutes) {
            const state = orderState[roomName].courses[courseName];
            
            if (minutes > 0) {
                const now = new Date();
                now.setMinutes(now.getMinutes() + minutes);
                const h = String(now.getHours()).padStart(2, '0');
                const m = String(now.getMinutes()).padStart(2, '0');
                state.time = `${h}:${m}`;
            } else {
                state.time = 'å£°ãŒã‘';
            }

            closeModal();
            saveOrderState();
            renderOrderPage();
        }

        // Wæ•°é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
        function showWCountModal(roomName, courseName) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            const room = settings.rooms.find(r => r.name === roomName);
            title.textContent = 'ç„¼ãåŠ æ¸›ã‚’é¸æŠ';
            
            const options = ['ãªã—', ...Array.from({length: room.people}, (_, i) => i + 1)];
            body.innerHTML = `
                <div class="modal-buttons">
                    ${options.map(opt => `
                        <button class="modal-btn" onclick="setWCount('${roomName}', '${courseName}', '${opt}')">
                            ${opt === 'ãªã—' ? 'ãªã—' : opt + 'å'}
                        </button>
                    `).join('')}
                </div>
            `;

            modal.classList.add('active');
        }

        function setWCount(roomName, courseName, count) {
            const state = orderState[roomName].courses[courseName];
            state.wCount = count === 'ãªã—' ? 0 : parseInt(count);

            closeModal();
            saveOrderState();
            renderOrderPage();
        }

        // ã‚¹ã‚¿ãƒƒãƒ•é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
        function showStaffModal(roomName, courseName) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = 'æä¾›ã‚¹ã‚¿ãƒƒãƒ•ã‚’é¸æŠ';
            
            const enabledStaff = [
                ...settings.staff.filter(s => s.enabled),
                ...settings.customStaff.filter(s => s.enabled)
            ];
            
            body.innerHTML = `
                <div class="staff-select-grid">
                    ${enabledStaff.map(staff => `
                        <button class="modal-btn" onclick="setStaff('${roomName}', '${courseName}', '${staff.name}')">
                            ${staff.name}
                        </button>
                    `).join('')}
                </div>
            `;

            modal.classList.add('active');
        }

        function setStaff(roomName, courseName, staffName) {
            const state = orderState[roomName].courses[courseName];
            state.staff = staffName;

            closeModal();
            saveOrderState();
            renderOrderPage();
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        // Undo
        function undoLastAction() {
            if (!lastAction) {
                alert('å…ƒã«æˆ»ã™æ“ä½œãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            orderState[lastAction.room].courses[lastAction.course] = lastAction.previousState;
            lastAction = null;

            saveOrderState();
            renderOrderPage();
        }

        // OrderåˆæœŸåŒ–
        function resetOrderState() {
            if (!confirm('Orderãƒšãƒ¼ã‚¸ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) return;
            
            initOrderState();
            saveOrderState();
            renderOrderPage();
            alert('ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼');
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));

            if (tab === 'index') {
                document.querySelector('.tab-btn:first-child').classList.add('active');
                document.getElementById('index-page').classList.add('active');
            } else {
                document.querySelector('.tab-btn:last-child').classList.add('active');
                document.getElementById('order-page').classList.add('active');
                renderOrderPage();
            }
        }

        // è¨­å®šæ›´æ–°é–¢æ•°
        function toggleRoom(index) {
            settings.rooms[index].enabled = !settings.rooms[index].enabled;
            renderIndexPage();
        }

        function updateRoomPeople(index, value) {
            settings.rooms[index].people = parseInt(value);
        }

        function updateRoomTime(index, value) {
            settings.rooms[index].time = value;
        }

        function updateRoomPlan(index, value) {
            settings.rooms[index].plan = value;
            settings.rooms[index].allergies = {};
            renderIndexPage();
        }

        function updateRoomMemo(index, value) {
            settings.rooms[index].memo = value;
        }

        function updateRoomCake(index, checked) {
            settings.rooms[index].hasCake = checked;
        }

        function updateRoomPlate(index, checked) {
            settings.rooms[index].hasPlate = checked;
        }

        function updateAllergy(roomIndex, course, value) {
            settings.rooms[roomIndex].allergies[course] = value;
        }

        function toggleStaff(index) {
            settings.staff[index].enabled = !settings.staff[index].enabled;
        }

        // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºéƒ¨å±‹é–¢é€£
        function addCustomRoom() {
            settings.customRooms.push({
                name: '',
                enabled: true,
                people: 2,
                time: '18:00',
                plan: 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰',
                memo: '',
                allergies: {},
                hasCake: false,
                hasPlate: false,
                isCustom: true
            });
            renderIndexPage();
        }

        function deleteCustomRoom(index) {
            if (confirm('ã“ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºéƒ¨å±‹ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                settings.customRooms.splice(index, 1);
                renderIndexPage();
            }
        }

        function toggleCustomRoom(index) {
            settings.customRooms[index].enabled = !settings.customRooms[index].enabled;
            renderIndexPage();
        }

        function updateCustomRoomName(index, value) {
            settings.customRooms[index].name = value;
        }

        function updateCustomRoomPeople(index, value) {
            settings.customRooms[index].people = parseInt(value);
        }

        function updateCustomRoomTime(index, value) {
            settings.customRooms[index].time = value;
        }

        function updateCustomRoomPlan(index, value) {
            settings.customRooms[index].plan = value;
            settings.customRooms[index].allergies = {};
            renderIndexPage();
        }

        function updateCustomRoomMemo(index, value) {
            settings.customRooms[index].memo = value;
        }

        function updateCustomRoomCake(index, checked) {
            settings.customRooms[index].hasCake = checked;
        }

        function updateCustomRoomPlate(index, checked) {
            settings.customRooms[index].hasPlate = checked;
        }

        // ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚¿ãƒƒãƒ•é–¢é€£
        function addCustomStaff() {
            const input = document.getElementById('custom-staff-input');
            const name = input.value.trim();
            
            if (!name) {
                alert('ã‚¹ã‚¿ãƒƒãƒ•åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            settings.customStaff.push({
                name: name,
                enabled: true,
                isCustom: true
            });
            
            input.value = '';
            renderIndexPage();
        }

        function deleteCustomStaff(index) {
            if (confirm('ã“ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã‚¹ã‚¿ãƒƒãƒ•ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                settings.customStaff.splice(index, 1);
                renderIndexPage();
            }
        }

        function toggleCustomStaff(index) {
            settings.customStaff[index].enabled = !settings.customStaff[index].enabled;
        }

        // ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ«
        function showAllergyModal(roomIndex, isCustom) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            const room = isCustom ? settings.customRooms[roomIndex] : settings.rooms[roomIndex];
            const courses = PLANS[room.plan];
            
            title.textContent = `${room.name} - ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è¨­å®š`;
            
            body.innerHTML = `
                <div class="allergy-modal-content">
                    ${courses.map(course => `
                        <div class="allergy-input-group">
                            <label>${course}</label>
                            <input type="text" 
                                   id="allergy-${course}" 
                                   value="${room.allergies[course] || ''}" 
                                   placeholder="ä¾‹: ãˆã³ãƒ»ã‹ã«">
                        </div>
                    `).join('')}
                </div>
                <button class="btn btn-primary" onclick="saveAllergies(${roomIndex}, ${isCustom})">
                    ä¿å­˜
                </button>
            `;
            
            modal.classList.add('active');
        }

        function saveAllergies(roomIndex, isCustom) {
            const room = isCustom ? settings.customRooms[roomIndex] : settings.rooms[roomIndex];
            const courses = PLANS[room.plan];
            
            courses.forEach(course => {
                const input = document.getElementById(`allergy-${course}`);
                if (input) {
                    room.allergies[course] = input.value.trim();
                }
            });
            
            closeModal();
            alert('ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        }

        // é£Ÿã¹ã‚‹ã‚¹ãƒ”ãƒ¼ãƒ‰é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«
        function showEatingSpeedModal(roomName) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.textContent = 'é£Ÿã¹ã‚‹ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’é¸æŠ';
            
            body.innerHTML = `
                <div class="modal-buttons">
                    ${EATING_SPEEDS.map(speed => `
                        <button class="modal-btn" onclick="setEatingSpeed('${roomName}', '${speed}')">
                            ${speed}
                        </button>
                    `).join('')}
                </div>
            `;

            modal.classList.add('active');
        }

        function setEatingSpeed(roomName, speed) {
            if (!orderState[roomName]) {
                orderState[roomName] = { eatingSpeed: 'N', courses: {} };
            }
            orderState[roomName].eatingSpeed = speed;

            closeModal();
            saveOrderState();
            renderOrderPage();
        }

        // åˆæœŸåŒ–å®Ÿè¡Œ
        init();
    </script>
</body>
</html>